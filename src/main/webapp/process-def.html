<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Process Definition List</title>
  <link rel="stylesheet" href="static/bootstrap-3.3.0.css">
</head>
<body>
<div class="container">
  <h2>Process Definition List</h2>
  <p></p>
  <div class="table-responsive">
    <table class="table table-bordered table-striped text-nowrap">
      <thead>
      <tr>
        <th>#</th>
        <th>Id</th>
        <th>Name</th>
        <th>Key</th>
        <th>Version</th>
        <th>DeploymentId</th>
      </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
</div>
<template id="procDefListTrTemplate">
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
</template>

<div id="messageModal" class="modal fade" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
      </div>
    </div>
  </div>
</div>

<script src="static/jquery-1.12.4.js"></script>
<script src="static/bootstrap-3.3.0.js"></script>
<script src="static/global.js"></script>
<script type="text/javascript">
  $(function () {
    loadList();
  });

  function loadList() {
    getListService(renderTable)
  }

  function handleResponse(response, callback) {
    if (response.code == "-1") {
      showMessage("服务器异常");
    } else if (response.code == "0") {
      callback(response.data);
    }
  }

  function showMessage(msg) {
    var msgModal = $("#messageModal");
    msgModal.find("div.modal-body").html(msg);
    msgModal.modal("show");
  }

  function getListService(callback) {
    $.getJSON(BASE_URL + "/process/def/list", null, function (response) {
      handleResponse(response, callback);
    });
  }

  function renderTable(list) {
    if (!list || list.length == 0) {
      return;
    }
    var $template = $($("#procDefListTrTemplate").prop("content"));
    var $tbody = $("table>tbody");
    $tbody.empty();
    $.each(list, function (i) {
      var item = this;
      try {
        var $tr = $template.clone().find("tr");
        var tds = $tr.find("td");
        var j = 0;
        fillTd(tds[j++], i + 1);
        fillTd(tds[j++], item.id);
        fillTd(tds[j++], item.name);
        fillTd(tds[j++], item.key);
        fillTd(tds[j++], item.version);
        fillTd(tds[j++], item.deploymentId);
        $tbody.append($tr);
      } catch (error) {
        console.error(error);
      }
    });
  }

  function fillTd(td, text) {
    $(td).html(text);
  }

</script>
</body>
</html>